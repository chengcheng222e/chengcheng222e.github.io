<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.cyblogs.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="一.简介简单的说，RedisTemplate和StringRedisTemplate的关系如下：  1.StringRedisTemplate是RedisTemplate的子类。 2.StringRedisTemplate的各个序列化策略都是StringRedisSerializer，而RedisTemplate用的是JdkSerializationRedisSerializer。  二.Redi">
<meta property="og:type" content="article">
<meta property="og:title" content="RedisTemplate和StringRedisTemplate的区别">
<meta property="og:url" content="http://www.cyblogs.com/2020/11/10/2020/11/RedisTemplate%E5%92%8CStringRedisTemplate%E7%9A%84%E5%8C%BA%E5%88%AB/index.html">
<meta property="og:site_name" content="简栈文化">
<meta property="og:description" content="一.简介简单的说，RedisTemplate和StringRedisTemplate的关系如下：  1.StringRedisTemplate是RedisTemplate的子类。 2.StringRedisTemplate的各个序列化策略都是StringRedisSerializer，而RedisTemplate用的是JdkSerializationRedisSerializer。  二.Redi">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-11-09T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-25T02:05:09.306Z">
<meta property="article:author" content="Vernon">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.cyblogs.com/2020/11/10/2020/11/RedisTemplate%E5%92%8CStringRedisTemplate%E7%9A%84%E5%8C%BA%E5%88%AB/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://www.cyblogs.com/2020/11/10/2020/11/RedisTemplate%E5%92%8CStringRedisTemplate%E7%9A%84%E5%8C%BA%E5%88%AB/","path":"2020/11/10/2020/11/RedisTemplate和StringRedisTemplate的区别/","title":"RedisTemplate和StringRedisTemplate的区别"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RedisTemplate和StringRedisTemplate的区别 | 简栈文化</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="简栈文化" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">简栈文化</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Java技术人的成长之路~</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">一.简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-RedisTemplate%E5%92%8CStringRedisTemplate%E7%9A%84%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">二.RedisTemplate和StringRedisTemplate的代码结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89-%E5%BA%8F%E5%88%97%E5%8C%96%E7%AD%96%E7%95%A5"><span class="nav-number">3.</span> <span class="nav-text">三.序列化策略</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#StringRedisSerializer"><span class="nav-number">3.1.</span> <span class="nav-text">StringRedisSerializer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#JdkSerializationRedisSerializer"><span class="nav-number">3.2.</span> <span class="nav-text">JdkSerializationRedisSerializer</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B-%E5%85%B3%E4%BA%8EredisTemplate%E7%9A%84Operations"><span class="nav-number">4.</span> <span class="nav-text">四.关于redisTemplate的Operations</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E5%9C%B0%E5%9D%80"><span class="nav-number">5.</span> <span class="nav-text">参考地址</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Vernon"
      src="/images/vernonchen.jpg">
  <p class="site-author-name" itemprop="name">Vernon</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">149</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">66</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">87</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/chengcheng222e" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chengcheng222e" rel="noopener me" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chengcheng222e@gmail.com" title="E-Mail → mailto:chengcheng222e@gmail.com" rel="noopener me" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.cyblogs.com/2020/11/10/2020/11/RedisTemplate%E5%92%8CStringRedisTemplate%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/vernonchen.jpg">
      <meta itemprop="name" content="Vernon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简栈文化">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RedisTemplate和StringRedisTemplate的区别 | 简栈文化">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RedisTemplate和StringRedisTemplate的区别
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-11-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-10T00:00:00+08:00">2020-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-25 10:05:09" itemprop="dateModified" datetime="2025-06-25T10:05:09+08:00">2025-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h4 id="一-简介"><a href="#一-简介" class="headerlink" title="一.简介"></a>一.简介</h4><p>简单的说，<code>RedisTemplate</code>和<code>StringRedisTemplate</code>的关系如下：</p>
<blockquote>
<p>1.<code>StringRedisTemplate</code>是<code>RedisTemplate</code>的子类。</p>
<p>2.<code>StringRedisTemplate</code>的各个序列化策略都是<code>StringRedisSerializer</code>，而<code>RedisTemplate</code>用的是<code>JdkSerializationRedisSerializer</code>。</p>
</blockquote>
<h4 id="二-RedisTemplate和StringRedisTemplate的代码结构"><a href="#二-RedisTemplate和StringRedisTemplate的代码结构" class="headerlink" title="二.RedisTemplate和StringRedisTemplate的代码结构"></a>二.RedisTemplate和StringRedisTemplate的代码结构</h4><p>从<code>RedisTemplate</code>类说起。</p>
<p>在<code>RedisTemplate</code>类中，定义了这样四个变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">keySerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">valueSerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">hashKeySerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">RedisSerializer</span> <span class="variable">hashValueSerializer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<p>分别代表了普通<code>key</code>，<code>value</code>，和<code>Hash</code>类型的<code>key</code>，value的序列化策略，可以分别设置。</p>
<p>另外定义变量，用来指定默认的序列化策略：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> RedisSerializer&lt;?&gt; defaultSerializer;</span><br></pre></td></tr></table></figure>

<p>在<code>RedisTemplate</code>类中，定义了<code>afterPropertiesSet()</code>方法，当<code>Spring</code>创建<code>RedisTemplate</code>类的对象时，会调用这个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.afterPropertiesSet();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">defaultUsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.defaultSerializer == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.defaultSerializer = <span class="keyword">new</span> <span class="title class_">JdkSerializationRedisSerializer</span>(<span class="built_in">this</span>.classLoader != <span class="literal">null</span> ? <span class="built_in">this</span>.classLoader : <span class="built_in">this</span>.getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.enableDefaultSerializer) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.keySerializer == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.keySerializer = <span class="built_in">this</span>.defaultSerializer;</span><br><span class="line">            defaultUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.valueSerializer == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.valueSerializer = <span class="built_in">this</span>.defaultSerializer;</span><br><span class="line">            defaultUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.hashKeySerializer == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.hashKeySerializer = <span class="built_in">this</span>.defaultSerializer;</span><br><span class="line">            defaultUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.hashValueSerializer == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.hashValueSerializer = <span class="built_in">this</span>.defaultSerializer;</span><br><span class="line">            defaultUsed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.enableDefaultSerializer &amp;&amp; defaultUsed) &#123;</span><br><span class="line">        Assert.notNull(<span class="built_in">this</span>.defaultSerializer, <span class="string">&quot;default serializer null and not all serializers initialized&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.scriptExecutor == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.scriptExecutor = <span class="keyword">new</span> <span class="title class_">DefaultScriptExecutor</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.initialized = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，在默认情况下，<code>RedisTemplate</code>使用的默认序列化策略是<code>JdkSerializationRedisSerializer</code>。包括<code>RedisTemplate</code>下的<code>key</code>，<code>value</code>，<code>hash-key</code>，hash-value的序列化，都用这种策略。</p>
<p>再来看看<code>StringRedisTemplate</code>，他作为RedisTemplate的子类，只是修改了序列化策略：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringRedisTemplate</span> <span class="keyword">extends</span> <span class="title class_">RedisTemplate</span>&lt;String, String&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StringRedisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; stringSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="built_in">this</span>.setKeySerializer(stringSerializer);</span><br><span class="line">        <span class="built_in">this</span>.setValueSerializer(stringSerializer);</span><br><span class="line">        <span class="built_in">this</span>.setHashKeySerializer(stringSerializer);</span><br><span class="line">        <span class="built_in">this</span>.setHashValueSerializer(stringSerializer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StringRedisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>();</span><br><span class="line">        <span class="built_in">this</span>.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="built_in">this</span>.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> RedisConnection <span class="title function_">preProcessConnection</span><span class="params">(RedisConnection connection, <span class="type">boolean</span> existingConnection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultStringRedisConnection</span>(connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是<code>StringRedisTemplate</code>整个类的内容，可以看到，在他的默认构造中，<code>key</code>，<code>value</code>，<code>hash-key</code>，<code>hash-value</code>都使用的是StringRedisSerializer类作为序列化策略。这也就是<code>StringRedisTemplate</code>和他的父类RedisTemplate的主要区别。</p>
<h4 id="三-序列化策略"><a href="#三-序列化策略" class="headerlink" title="三.序列化策略"></a>三.序列化策略</h4><p>更进一步，看一下这个序列化策略是什么。</p>
<p>上面提到的<code>StringRedisSerializer</code>和<code>JdkSerializationRedisSerializer</code>都是序列化策略类，他们都实现了一个<code>RedisSerializer&lt;T&gt;</code>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RedisSerializer</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="type">byte</span>[] serialize(<span class="meta">@Nullable</span> T var1) <span class="keyword">throws</span> SerializationException;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">deserialize</span><span class="params">(<span class="meta">@Nullable</span> <span class="type">byte</span>[] var1)</span> <span class="keyword">throws</span> SerializationException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口表达的意思很简单，两个方法，serialize用于序列化，把对象变为<code>byte</code>数组，<code>deserialize</code>用于反序列化，把byte数组转为对象。</p>
<h5 id="StringRedisSerializer"><a href="#StringRedisSerializer" class="headerlink" title="StringRedisSerializer"></a>StringRedisSerializer</h5><p>看看<code>StringRedisSerializer</code>是怎么做的：</p>
<p><strong>1.StringRedisSerializer的构造：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">StringRedisSerializer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(StandardCharsets.UTF_8);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">StringRedisSerializer</span><span class="params">(Charset charset)</span> &#123;</span><br><span class="line">    Assert.notNull(charset, <span class="string">&quot;Charset must not be null!&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.charset = charset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义了编码格式，默认<code>UTF_8</code>。</p>
<p><strong>2.StringRedisSerializer的serialize和deserialize方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">deserialize</span><span class="params">(<span class="meta">@Nullable</span> <span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> bytes == <span class="literal">null</span> ? <span class="literal">null</span> : <span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="built_in">this</span>.charset);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] serialize(<span class="meta">@Nullable</span> String string) &#123;</span><br><span class="line">    <span class="keyword">return</span> string == <span class="literal">null</span> ? <span class="literal">null</span> : string.getBytes(<span class="built_in">this</span>.charset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>StringRedisSerializer</code>采用的是字符串和对应编码下二进制数组之间的转换。</p>
<p>在这种编码格式下，如果我们向redis保存信息，然后用客户端访问<code>Redis</code>时，只要编码格式一致，就能看到保存信息的原文。保存字符串<code>ABC</code>，客户端看到的也是字符串<code>ABC</code>。</p>
<h5 id="JdkSerializationRedisSerializer"><a href="#JdkSerializationRedisSerializer" class="headerlink" title="JdkSerializationRedisSerializer"></a>JdkSerializationRedisSerializer</h5><p>然后对比看看<code>JdkSerializationRedisSerializer</code>是怎么做的。</p>
<p><strong>1.JdkSerializationRedisSerializer的构造：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Converter&lt;Object, <span class="type">byte</span>[]&gt; serializer;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Converter&lt;<span class="type">byte</span>[], Object&gt; deserializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">JdkSerializationRedisSerializer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">SerializingConverter</span>(), <span class="keyword">new</span> <span class="title class_">DeserializingConverter</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">JdkSerializationRedisSerializer</span><span class="params">(ClassLoader classLoader)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(<span class="keyword">new</span> <span class="title class_">SerializingConverter</span>(), <span class="keyword">new</span> <span class="title class_">DeserializingConverter</span>(classLoader));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>JdkSerializationRedisSerializer</code>定义了两个变量，serializer和<code>deserializer</code>，显然是用来序列化和反序列化的，他们两个的类型是一样的，都是Converter接口，只是泛型不同。</p>
<p>Converter接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Converter</span>&lt;S, T&gt; &#123;</span><br><span class="line">        <span class="meta">@Nullable</span></span><br><span class="line">        T <span class="title function_">convert</span><span class="params">(S source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就一个方法。</p>
<p>另外在<code>JdkSerializationRedisSerializer</code>的构造中，对serializer和<code>deserializer</code>进行了初始化，使用<code>SerializingConverter</code>和DeserializingConverter作为实现类。</p>
<p><strong>2.JdkSerializationRedisSerializer的serialize和deserialize方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">deserialize</span><span class="params">(<span class="meta">@Nullable</span> <span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (SerializationUtils.isEmpty(bytes)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.deserializer.convert(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SerializationException</span>(<span class="string">&quot;Cannot deserialize&quot;</span>, var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] serialize(<span class="meta">@Nullable</span> Object object) &#123;</span><br><span class="line">    <span class="keyword">if</span> (object == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> SerializationUtils.EMPTY_ARRAY;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">byte</span>[])<span class="built_in">this</span>.serializer.convert(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SerializationException</span>(<span class="string">&quot;Cannot serialize&quot;</span>, var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实就是调用了对应<code>Converter</code>的<code>convert</code>方法。</p>
<p><strong>3.关于Converter</strong></p>
<p>既然到这了，就再深入一步，看看<code>SerializingConverter</code>和DeserializingConverter的<code>convert</code>方法。</p>
<p><strong>首先，序列化：</strong></p>
<p><code>SerializingConverter</code>的相关方法，贴一部分关键的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SerializingConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serializer = <span class="keyword">new</span> <span class="title class_">DefaultSerializer</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] convert(Object source) &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(<span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">try</span>  &#123;</span><br><span class="line">                <span class="built_in">this</span>.serializer.serialize(source, byteStream);</span><br><span class="line">                <span class="keyword">return</span> byteStream.toByteArray();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SerializationFailedException</span>(<span class="string">&quot;Failed to serialize object using &quot;</span> +</span><br><span class="line">                                <span class="built_in">this</span>.serializer.getClass().getSimpleName(), ex);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>SerializingConverter</code>类定义了<code>serializer</code>变量，用<strong>DefaultSerializer</strong>类实现，序列化的方式是调用<code>DefaultSerializer</code>的<code>serialize</code>方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object object, OutputStream outputStream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object <span class="keyword">instanceof</span> Serializable)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(getClass().getSimpleName() + <span class="string">&quot; requires a Serializable payload &quot;</span> +</span><br><span class="line">                                <span class="string">&quot;but received an object of type [&quot;</span> + object.getClass().getName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(outputStream);</span><br><span class="line">        objectOutputStream.writeObject(object);</span><br><span class="line">        objectOutputStream.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DefaultSerializer</code>的<code>serialize</code>方法使用了<code>ObjectOutputStream</code>，调用writeObject方法序列化对象。</p>
<p><strong>对应的，反序列化：</strong></p>
<p><code>DeserializingConverter</code>的convert方法，贴一下相关代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">DeserializingConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.deserializer = <span class="keyword">new</span> <span class="title class_">DefaultDeserializer</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">convert</span><span class="params">(<span class="type">byte</span>[] source)</span> &#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(source);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.deserializer.deserialize(byteStream);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SerializationFailedException</span>(<span class="string">&quot;Failed to deserialize payload. &quot;</span> +</span><br><span class="line">                                <span class="string">&quot;Is the byte array a result of corresponding serialization for &quot;</span> +</span><br><span class="line">                                <span class="built_in">this</span>.deserializer.getClass().getSimpleName() + <span class="string">&quot;?&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见<code>DeserializingConverter</code>使用了<strong>DefaultDeserializer</strong>作为反序列化工具，调用了他的deserialize方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">deserialize</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurableObjectInputStream</span>(inputStream, <span class="built_in">this</span>.classLoader);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> objectInputStream.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NestedIOException</span>(<span class="string">&quot;Failed to deserialize object type&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对比<code>SerializingConverter</code>，<code>DeserializingConverter</code>使用的是<code>ConfigurableObjectInputStream</code>，并调用他的<code>readObject</code>方法进行反序列化。</p>
<p>这种序列化方式，如果保存信息至<code>redis</code>，用客户端查看时，保存的信息看起来像是在原来的字符前面加了几个字符。</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JdkSerializationRedisSerializer</span> <span class="variable">jdkSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdkSerializationRedisSerializer</span>();</span><br><span class="line"><span class="type">StringRedisSerializer</span> <span class="variable">stringSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line"><span class="type">byte</span>[] jdkByteArr = jdkSerializer.serialize(<span class="string">&quot;CSDN博客&quot;</span>);</span><br><span class="line"><span class="type">byte</span>[] stringByteArr = stringSerializer.serialize(<span class="string">&quot;CSDN博客&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这种情况下，得到的<code>byte</code>数组是：</p>
<p><code>jdkByteArr</code>：</p>
<blockquote>
<p>{-84,-19,0,5,116,0,10,67,83,68,78,-27,-115,-102,-27,-82,-94}</p>
</blockquote>
<p>stringByteArr：</p>
<blockquote>
<p>{67,83,68,78,-27,-115,-102,-27,-82,-94}</p>
</blockquote>
<p><code>StringRedisSerializer</code>把字符串本身转化成<code>byte</code>数组，而<code>JdkSerializationRedisSerializer</code>在数组前面加了几个字符，这些字符也会被保存到redis中。</p>
<p>所以，从数据上来说，这两种序列化策略处理的数据是不会共通的，各人管各人的。</p>
<h4 id="四-关于redisTemplate的Operations"><a href="#四-关于redisTemplate的Operations" class="headerlink" title="四.关于redisTemplate的Operations"></a>四.关于redisTemplate的Operations</h4><p>使用<code>redisTemplate</code>时，除了调用<code>execute</code>方法并自定义RedisCallback之外，还可以使用<code>redisTemplate</code>提供的几个Operations接口。</p>
<p><code>redisTemplate</code>中定义了以下几个<code>Operations</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> ValueOperations&lt;K, V&gt; valueOps;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> ListOperations&lt;K, V&gt; listOps;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> SetOperations&lt;K, V&gt; setOps;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> ZSetOperations&lt;K, V&gt; zSetOps;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> GeoOperations&lt;K, V&gt; geoOps;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> HyperLogLogOperations&lt;K, V&gt; hllOps;</span><br></pre></td></tr></table></figure>

<p>这几个<code>Operations</code>接口，分别提供了对不同种类数据的操作方法。</p>
<p>以<code>ValueOperations</code>为例，他提供的方法有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K var1, V var2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K var1, V var2, <span class="type">long</span> var3, TimeUnit var5)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Boolean <span class="title function_">setIfAbsent</span><span class="params">(K var1, V var2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">multiSet</span><span class="params">(Map&lt;? extends K, ? extends V&gt; var1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Boolean <span class="title function_">multiSetIfAbsent</span><span class="params">(Map&lt;? extends K, ? extends V&gt; var1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">V <span class="title function_">get</span><span class="params">(Object var1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">V <span class="title function_">getAndSet</span><span class="params">(K var1, V var2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">List&lt;V&gt; <span class="title function_">multiGet</span><span class="params">(Collection&lt;K&gt; var1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Long <span class="title function_">increment</span><span class="params">(K var1, <span class="type">long</span> var2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Double <span class="title function_">increment</span><span class="params">(K var1, <span class="type">double</span> var2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Integer <span class="title function_">append</span><span class="params">(K var1, String var2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">String <span class="title function_">get</span><span class="params">(K var1, <span class="type">long</span> var2, <span class="type">long</span> var4)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K var1, V var2, <span class="type">long</span> var3)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Long <span class="title function_">size</span><span class="params">(K var1)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Boolean <span class="title function_">setBit</span><span class="params">(K var1, <span class="type">long</span> var2, <span class="type">boolean</span> var4)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Boolean <span class="title function_">getBit</span><span class="params">(K var1, <span class="type">long</span> var2)</span>;</span><br></pre></td></tr></table></figure>

<p>其他的<code>Operations</code>提供的方法各有不同，但是这些<code>Operations</code>的使用方式都是相同的。</p>
<p>不同的Operations分别通过<code>RedisTemplate</code>的以下方法获取：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ValueOperations&lt;K, V&gt; <span class="title function_">opsForValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.valueOps == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.valueOps = <span class="keyword">new</span> <span class="title class_">DefaultValueOperations</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.valueOps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ListOperations&lt;K, V&gt; <span class="title function_">opsForList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.listOps == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.listOps = <span class="keyword">new</span> <span class="title class_">DefaultListOperations</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.listOps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> SetOperations&lt;K, V&gt; <span class="title function_">opsForSet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.setOps == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.setOps = <span class="keyword">new</span> <span class="title class_">DefaultSetOperations</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.setOps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ZSetOperations&lt;K, V&gt; <span class="title function_">opsForZSet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.zSetOps == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.zSetOps = <span class="keyword">new</span> <span class="title class_">DefaultZSetOperations</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.zSetOps;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> GeoOperations&lt;K, V&gt; <span class="title function_">opsForGeo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.geoOps == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.geoOps = <span class="keyword">new</span> <span class="title class_">DefaultGeoOperations</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.geoOps;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见，在这些获得<code>Operations</code>的方法中，都提供了一个默认实现类，并且把<code>RedisTemplate</code>对象本身当做参数传给了这个实现类。</p>
<p>还是以<code>ValueOperations</code>为例，<code>RedisTemplate</code>提供的默认实现类是DefaultValueOperations，看看这个类的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.data.redis.core;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.AbstractOperations.ValueDeserializingRedisCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultValueOperations</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">AbstractOperations</span>&lt;K, V&gt; <span class="keyword">implements</span> <span class="title class_">ValueOperations</span>&lt;K, V&gt; &#123;</span><br><span class="line">    DefaultValueOperations(RedisTemplate&lt;K, V&gt; template) &#123;</span><br><span class="line">        <span class="built_in">super</span>(template);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.execute(<span class="keyword">new</span> <span class="title class_">AbstractOperations</span>&lt;K, V&gt;.ValueDeserializingRedisCallback(key) &#123;</span><br><span class="line">            <span class="keyword">protected</span> <span class="type">byte</span>[] inRedis(<span class="type">byte</span>[] rawKey, RedisConnection connection) &#123;</span><br><span class="line">                <span class="keyword">return</span> connection.get(rawKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> V <span class="title function_">getAndSet</span><span class="params">(K key, V newValue)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] rawValue = <span class="built_in">this</span>.rawValue(newValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.execute(<span class="keyword">new</span> <span class="title class_">AbstractOperations</span>&lt;K, V&gt;.ValueDeserializingRedisCallback(key) &#123;</span><br><span class="line">            <span class="keyword">protected</span> <span class="type">byte</span>[] inRedis(<span class="type">byte</span>[] rawKey, RedisConnection connection) &#123;</span><br><span class="line">                <span class="keyword">return</span> connection.getSet(rawKey, rawValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">increment</span><span class="params">(K key, <span class="type">long</span> delta)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="keyword">return</span> (Long)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.incrBy(rawKey, delta);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">increment</span><span class="params">(K key, <span class="type">double</span> delta)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="keyword">return</span> (Double)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.incrBy(rawKey, delta);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">append</span><span class="params">(K key, String value)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="type">byte</span>[] rawString = <span class="built_in">this</span>.rawString(value);</span><br><span class="line">        <span class="keyword">return</span> (Integer)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> connection.append(rawKey, rawString);</span><br><span class="line">            <span class="keyword">return</span> result != <span class="literal">null</span> ? result.intValue() : <span class="literal">null</span>;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(K key, <span class="type">long</span> start, <span class="type">long</span> end)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="type">byte</span>[] rawReturn = (<span class="type">byte</span>[])<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.getRange(rawKey, start, end);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.deserializeString(rawReturn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;V&gt; <span class="title function_">multiGet</span><span class="params">(Collection&lt;K&gt; keys)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (keys.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[][] rawKeys = <span class="keyword">new</span> <span class="title class_">byte</span>[keys.size()][];</span><br><span class="line">            <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            Object hashKey;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> keys.iterator(); var4.hasNext(); rawKeys[counter++] = <span class="built_in">this</span>.rawKey(hashKey)) &#123;</span><br><span class="line">                hashKey = var4.next();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List&lt;<span class="type">byte</span>[]&gt; rawValues = (List)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> connection.mGet(rawKeys);</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.deserializeValues(rawValues);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">multiSet</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!m.isEmpty()) &#123;</span><br><span class="line">            Map&lt;<span class="type">byte</span>[], <span class="type">byte</span>[]&gt; rawKeys = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>(m.size());</span><br><span class="line">            <span class="type">Iterator</span> <span class="variable">var3</span> <span class="operator">=</span> m.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span class="line">                Entry&lt;? <span class="keyword">extends</span> <span class="title class_">K</span>, ? <span class="keyword">extends</span> <span class="title class_">V</span>&gt; entry = (Entry)var3.next();</span><br><span class="line">                rawKeys.put(<span class="built_in">this</span>.rawKey(entry.getKey()), <span class="built_in">this</span>.rawValue(entry.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">                connection.mSet(rawKeys);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">multiSetIfAbsent</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (m.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Map&lt;<span class="type">byte</span>[], <span class="type">byte</span>[]&gt; rawKeys = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>(m.size());</span><br><span class="line">            <span class="type">Iterator</span> <span class="variable">var3</span> <span class="operator">=</span> m.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span class="line">                Entry&lt;? <span class="keyword">extends</span> <span class="title class_">K</span>, ? <span class="keyword">extends</span> <span class="title class_">V</span>&gt; entry = (Entry)var3.next();</span><br><span class="line">                rawKeys.put(<span class="built_in">this</span>.rawKey(entry.getKey()), <span class="built_in">this</span>.rawValue(entry.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> connection.mSetNX(rawKeys);</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] rawValue = <span class="built_in">this</span>.rawValue(value);</span><br><span class="line">        <span class="built_in">this</span>.execute(<span class="keyword">new</span> <span class="title class_">AbstractOperations</span>&lt;K, V&gt;.ValueDeserializingRedisCallback(key) &#123;</span><br><span class="line">            <span class="keyword">protected</span> <span class="type">byte</span>[] inRedis(<span class="type">byte</span>[] rawKey, RedisConnection connection) &#123;</span><br><span class="line">                connection.set(rawKey, rawValue);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K key, V value, <span class="keyword">final</span> <span class="type">long</span> timeout, <span class="keyword">final</span> TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">byte</span>[] rawValue = <span class="built_in">this</span>.rawValue(value);</span><br><span class="line">        <span class="built_in">this</span>.execute(<span class="keyword">new</span> <span class="title class_">RedisCallback</span>&lt;Object&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">doInRedis</span><span class="params">(RedisConnection connection)</span> <span class="keyword">throws</span> DataAccessException &#123;</span><br><span class="line">                <span class="built_in">this</span>.potentiallyUsePsetEx(connection);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">potentiallyUsePsetEx</span><span class="params">(RedisConnection connection)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!TimeUnit.MILLISECONDS.equals(unit) || !<span class="built_in">this</span>.failsafeInvokePsetEx(connection)) &#123;</span><br><span class="line">                    connection.setEx(rawKey, TimeoutUtils.toSeconds(timeout, unit), rawValue);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">failsafeInvokePsetEx</span><span class="params">(RedisConnection connection)</span> &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.pSetEx(rawKey, timeout, rawValue);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (UnsupportedOperationException var4) &#123;</span><br><span class="line">                    failed = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> !failed;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">setIfAbsent</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="type">byte</span>[] rawValue = <span class="built_in">this</span>.rawValue(value);</span><br><span class="line">        <span class="keyword">return</span> (Boolean)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.setNX(rawKey, rawValue);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K key, V value, <span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="type">byte</span>[] rawValue = <span class="built_in">this</span>.rawValue(value);</span><br><span class="line">        <span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            connection.setRange(rawKey, rawValue, offset);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">size</span><span class="params">(K key)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="keyword">return</span> (Long)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.strLen(rawKey);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">setBit</span><span class="params">(K key, <span class="type">long</span> offset, <span class="type">boolean</span> value)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="keyword">return</span> (Boolean)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.setBit(rawKey, offset, value);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">getBit</span><span class="params">(K key, <span class="type">long</span> offset)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] rawKey = <span class="built_in">this</span>.rawKey(key);</span><br><span class="line">        <span class="keyword">return</span> (Boolean)<span class="built_in">this</span>.execute((connection) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> connection.getBit(rawKey, offset);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所有<code>Operations</code>实现类都是<code>AbstractOperations</code>的子类，另外各自实现各自的接口。</p>
<p>实现类的方法中多数都是调用了<code>this.execute()</code>方法，这个方法在父类AbstractOperations中，最终调用的其实也是<code>RedisTemplate</code>的<code>execute()</code>方法。</p>
<p>以上面<code>DefaultValueOperations</code>的<code>set()</code>方法为例，看一下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">byte</span>[] rawValue = <span class="built_in">this</span>.rawValue(value);</span><br><span class="line">    <span class="built_in">this</span>.execute(<span class="keyword">new</span> <span class="title class_">AbstractOperations</span>&lt;K, V&gt;.ValueDeserializingRedisCallback(key) &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="type">byte</span>[] inRedis(<span class="type">byte</span>[] rawKey, RedisConnection connection) &#123;</span><br><span class="line">            connection.set(rawKey, rawValue);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先是对<code>value</code>的处理，调用<code>this.rawValue()</code>方法，把value序列化成<code>byte</code>数组，这个方法在父类<code>AbstractOperations</code>中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] rawValue(Object value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.valueSerializer() == <span class="literal">null</span> &amp;&amp; value <span class="keyword">instanceof</span> <span class="type">byte</span>[] ? (<span class="type">byte</span>[])((<span class="type">byte</span>[])value) : <span class="built_in">this</span>.valueSerializer().serialize(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见，代码用的是自己的<code>valueSerializer</code>来序列化<code>value</code>，这个valueSerializer来自<code>RedisTemplate</code>。</p>
<p>回到<code>set()</code>方法，<code>value</code>序列化完成后，调用<code>this.execute()</code>方法，给此方法传递的第一个参数是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">AbstractOperations</span>&lt;K, V&gt;.ValueDeserializingRedisCallback(key) &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">byte</span>[] inRedis(<span class="type">byte</span>[] rawKey, RedisConnection connection) &#123;</span><br><span class="line">        connection.set(rawKey, rawValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个参数实际上是一个<code>ValueDeserializingRedisCallback</code>对象，在其中定义了<code>inRedis()</code>方法的实现。</p>
<p><code>this.execute()</code>方法在父类AbstractOperations中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">&lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisCallback&lt;T&gt; callback, <span class="type">boolean</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.template.execute(callback, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>this.template</code>指的就是初始化时传入的<code>RedisTemplate</code>，其execute()方法是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisCallback&lt;T&gt; action, <span class="type">boolean</span> exposeConnection)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.execute(action, exposeConnection, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后调用下面的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(RedisCallback&lt;T&gt; action, <span class="type">boolean</span> exposeConnection, <span class="type">boolean</span> pipeline)</span> &#123;</span><br><span class="line">    Assert.isTrue(<span class="built_in">this</span>.initialized, <span class="string">&quot;template not initialized; call afterPropertiesSet() before using it&quot;</span>);</span><br><span class="line">    Assert.notNull(action, <span class="string">&quot;Callback object must not be null&quot;</span>);</span><br><span class="line">    <span class="type">RedisConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="built_in">this</span>.getRequiredConnectionFactory();</span><br><span class="line">    <span class="type">RedisConnection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    Object var11;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.enableTransactionSupport) &#123;</span><br><span class="line">            conn = RedisConnectionUtils.bindConnection(factory, <span class="built_in">this</span>.enableTransactionSupport);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            conn = RedisConnectionUtils.getConnection(factory);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">existingConnection</span> <span class="operator">=</span> TransactionSynchronizationManager.hasResource(factory);</span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">connToUse</span> <span class="operator">=</span> <span class="built_in">this</span>.preProcessConnection(conn, existingConnection);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">pipelineStatus</span> <span class="operator">=</span> connToUse.isPipelined();</span><br><span class="line">        <span class="keyword">if</span> (pipeline &amp;&amp; !pipelineStatus) &#123;</span><br><span class="line">            connToUse.openPipeline();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">connToExpose</span> <span class="operator">=</span> exposeConnection ? connToUse : <span class="built_in">this</span>.createRedisConnectionProxy(connToUse);</span><br><span class="line">        <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> action.doInRedis(connToExpose);</span><br><span class="line">        <span class="keyword">if</span> (pipeline &amp;&amp; !pipelineStatus) &#123;</span><br><span class="line">            connToUse.closePipeline();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var11 = <span class="built_in">this</span>.postProcessResult(result, connToUse, existingConnection);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        RedisConnectionUtils.releaseConnection(conn, factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> var11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法初始化了<code>RedisConnection</code>，最后面调用了<code>RedisCallback</code>的<code>doInRedis()</code>方法，也就是这一行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> action.doInRedis(connToExpose);</span><br></pre></td></tr></table></figure>

<p>这里的变量<code>action</code>就是在<code>set()</code>方法中自定义的<code>new AbstractOperations&lt;K, V&gt;.ValueDeserializingRedisCallback(key)</code>。</p>
<p><code>ValueDeserializingRedisCallback</code>类是<code>AbstractOperations</code>的内部抽象类，他的<code>doInRedis()</code>方法是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title function_">doInRedis</span><span class="params">(RedisConnection connection)</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] result = <span class="built_in">this</span>.inRedis(AbstractOperations.<span class="built_in">this</span>.rawKey(<span class="built_in">this</span>.key), connection);</span><br><span class="line">    <span class="keyword">return</span> AbstractOperations.<span class="built_in">this</span>.deserializeValue(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可见调用了<code>inRedis()</code>方法，其第一个参数是序列化后的<code>key</code>，调用的是<code>AbstractOperations</code>的<code>rawKey()</code>方法，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] rawKey(Object key) &#123;</span><br><span class="line">    Assert.notNull(key, <span class="string">&quot;non null key required&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.keySerializer() == <span class="literal">null</span> &amp;&amp; key <span class="keyword">instanceof</span> <span class="type">byte</span>[] ? (<span class="type">byte</span>[])((<span class="type">byte</span>[])key) : <span class="built_in">this</span>.keySerializer().serialize(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里把<code>key</code>进行序列化，<code>keySerializer()</code>方法从<code>RedisTemplate</code>中获取<code>keySerializer</code>，并由<code>keySerializer</code>对<code>key</code>进行序列化。</p>
<p>在<code>ValueDeserializingRedisCallback</code>类中的<code>inRedis()</code>方法是抽象方法，具体的实现在<code>DefaultValueOperations</code>的<code>set()</code>方法中，也就是这一部分：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">byte</span>[] inRedis(<span class="type">byte</span>[] rawKey, RedisConnection connection) &#123;</span><br><span class="line">    connection.set(rawKey, rawValue);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终调用的是<code>RedisConnection</code>的<code>set()</code>方法，完成<code>Redis</code>的<code>set</code>操作。</p>
<p>以上就是在RedisTemplate中使用<code>ValueOperations</code>进行<code>set</code>操作的全部代码流程。</p>
<p>对<code>Redis</code>的不同操作分散在<code>RedisTemplate</code>的不同Operations中，只是调用的方法不同，调用流程都差不多。</p>
<h4 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h4><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lkforce/article/details/103685707">https://blog.csdn.net/lkforce/article/details/103685707</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Redis/" rel="tag"># Redis</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/11/07/2020/10/%E6%96%B0%E7%89%88IDEA%202020.1%E7%A2%B0%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/" rel="prev" title="新版IDEA 2020.1碰到的一个小坑">
                  <i class="fa fa-angle-left"></i> 新版IDEA 2020.1碰到的一个小坑
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/11/12/2020/11/%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E7%8E%A9Git%E5%88%86%E6%94%AF%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%91%A2%EF%BC%9F/" rel="next" title="你是如何玩Git分支模型的呢？">
                  你是如何玩Git分支模型的呢？ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Vernon</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
    <a target="_blank" href="https://beian.miit.gov.cn">粤ICP备2025433887号</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
