<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Redis," />


<meta name="description" content="一、Redis-Sentinel(哨兵)1、介绍Redis-Sentinel是redis官方推荐的高可用性解决方案，当用redis作master-slave的高可用时，如果master本身宕机，redis本身或者客户端都没有实现主从切换的功能。 而redis-sentinel就是一个独立运行的进程，用于监控多个master-slave集群，自动发现master宕机，进行自动切换slave &gt;">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis哨兵模式与分区详细分析">
<meta property="og:url" content="http://www.cyblogs.com/2020/03/20/2020/03/Redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%88%86%E5%8C%BA%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="简栈文化">
<meta property="og:description" content="一、Redis-Sentinel(哨兵)1、介绍Redis-Sentinel是redis官方推荐的高可用性解决方案，当用redis作master-slave的高可用时，如果master本身宕机，redis本身或者客户端都没有实现主从切换的功能。 而redis-sentinel就是一个独立运行的进程，用于监控多个master-slave集群，自动发现master宕机，进行自动切换slave &gt;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081403893-388342745.png">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081416634-1637699103.png">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081538985-1395233418.png">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081557550-451529206.png">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081612394-1096354711.png">
<meta property="og:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117082348428-1446271590.png">
<meta property="article:published_time" content="2020-03-19T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-24T14:38:12.668Z">
<meta property="article:author" content="Vernon">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081403893-388342745.png">


  


  <link rel="alternate" href="/atom.xml" title="简栈文化" type="application/atom+xml" />




  <link rel="canonical" href="http://www.cyblogs.com/2020/03/20/2020/03/Redis哨兵模式与分区详细分析/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>Redis哨兵模式与分区详细分析 | 简栈文化</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">简栈文化</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Java技术人的成长之路~</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.cyblogs.com/2020/03/20/2020/03/Redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%88%86%E5%8C%BA%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vernon">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/%E4%B8%AA%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简栈文化">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Redis哨兵模式与分区详细分析</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-20T00:00:00+08:00">2020-03-20</time>
            

            
            
              
                
              
            

            
              
              <span class="post-meta-divider">|</span>
              

              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2025-06-24T22:38:12+08:00">2025-06-24</time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="一、Redis-Sentinel-哨兵"><a href="#一、Redis-Sentinel-哨兵" class="headerlink" title="一、Redis-Sentinel(哨兵)"></a>一、Redis-Sentinel(哨兵)</h3><h4 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h4><p>Redis-Sentinel是redis官方推荐的高可用性解决方案，<br>当用redis作master-slave的高可用时，如果master本身宕机，redis本身或者客户端都没有实现主从切换的功能。</p>
<p>而redis-sentinel就是一个独立运行的进程，用于监控多个master-slave集群，<br>自动发现master宕机，进行自动切换slave &gt; master。</p>
<p><strong>sentinel主要功能如下：</strong></p>
<p>　　1. 不时的监控redis是否良好运行，如果节点不可达就会对节点进行下线标识<br>　　2. 如果被标识的是主节点，sentinel就会和其他的sentinel节点“协商”，如果其他节点也认为主节点不可达，<br>　　  就会选举一个sentinel节点来完成自动故障转移<br>　　3. 在master-slave进行切换后，master_redis.conf、slave_redis.conf和sentinel.conf的内容都会发生改变，<br>　　  即master_redis.conf中会多一行slaveof的配置，sentinel.conf的监控目标会随之调换</p>
<h4 id="2、工作原理"><a href="#2、工作原理" class="headerlink" title="2、工作原理"></a>2、工作原理</h4><p>每个Sentinel以每秒钟一次的频率向它所知的Master，Slave以及其他 Sentinel 实例发送一个 PING 命令</p>
<p>如果一个实例（instance）距离最后一次有效回复 PING 命令的时间超过 down-after-milliseconds 选项所指定的值， 则这个实例会被 Sentinel 标记为主观下线。</p>
<p>如果一个Master被标记为主观下线，则正在监视这个Master的所有 Sentinel 要以每秒一次的频率确认Master的确进入了主观下线状态。</p>
<p>当有足够数量的 Sentinel（大于等于配置文件指定的值）在指定的时间范围内确认Master的确进入了主观下线状态， 则Master会被标记为客观下线</p>
<p>在一般情况下， 每个 Sentinel 会以每 10 秒一次的频率向它已知的所有Master，Slave发送 INFO 命令</p>
<p>当Master被 Sentinel 标记为客观下线时，Sentinel 向下线的 Master 的所有 Slave 发送 INFO 命令的频率会从 10 秒一次改为每秒一次</p>
<p>若没有足够数量的 Sentinel 同意 Master 已经下线， Master 的客观下线状态就会被移除。</p>
<p>若 Master 重新向 Sentinel 的 PING 命令返回有效回复， Master 的主观下线状态就会被移除。</p>
<p>主观下线和客观下线</p>
<p>主观下线：Subjectively Down，简称 SDOWN，指的是当前 Sentinel 实例对某个redis服务器做出的下线判断。<br>客观下线：Objectively Down， 简称 ODOWN，指的是多个 Sentinel 实例在对Master Server做出 SDOWN 判断，并且通过 SENTINEL is-master-down-by-addr 命令互相交流之后，得出的Master Server下线判断，然后开启failover.</p>
<p>SDOWN适合于Master和Slave，只要一个 Sentinel 发现Master进入了ODOWN， 这个 Sentinel 就可能会被其他 Sentinel 推选出， 并对下线的主服务器执行自动故障迁移操作。</p>
<p>ODOWN只适用于Master，对于Slave的 Redis 实例，Sentinel 在将它们判断为下线前不需要进行协商， 所以Slave的 Sentinel 永远不会达到ODOWN。</p>
<h4 id="3、master宕机处理"><a href="#3、master宕机处理" class="headerlink" title="3、master宕机处理"></a>3、master宕机处理</h4><p><img src="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081403893-388342745.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081416634-1637699103.png" alt="img"></p>
<p>如果master宕机，我们应该先选一个slave出来，让他成为新的master，其他redis都修改成这个新的master的slave，但是redis本身或者客户端都没有实现主从切换的功能，当然，人为地修改配置文件，实现上图的功能也是可以的，但是如果是在深夜，所有人都睡觉了呢，谁来修改配置信息？这个时候就可以使用redis的Sentinel功能了，它就是实现了，当发现master宕机，自动帮我们去修改其他redis配置文件，选举出一个新master。</p>
<h4 id="4、Sentinel功能实现图"><a href="#4、Sentinel功能实现图" class="headerlink" title="4、Sentinel功能实现图"></a>4、Sentinel功能实现图</h4><p><img src="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081538985-1395233418.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081557550-451529206.png" alt="img"></p>
<p><img src="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117081612394-1096354711.png" alt="img"></p>
<h4 id="5、redis一些查看命令"><a href="#5、redis一些查看命令" class="headerlink" title="5、redis一些查看命令"></a>5、redis一些查看命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli info  # 查看redis数据库信息</span><br><span class="line"></span><br><span class="line">redis-cli info replication # 查看redis的复制授权信息(主从复制)</span><br><span class="line"></span><br><span class="line">redis-cli info sentinel   # 查看redis的哨兵信息</span><br></pre></td></tr></table></figure>



<h4 id="6、Redis主从配置"><a href="#6、Redis主从配置" class="headerlink" title="6、Redis主从配置"></a>6、Redis主从配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1.准备三个redis实例，一主两从</span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-6379.conf配置</span></span><br><span class="line">port 6379</span><br><span class="line">daemonize yes</span><br><span class="line">logfile "6379.log"</span><br><span class="line">dbfilename "dump-6379.rdb"</span><br><span class="line">dir "/var/redis/data/"</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-6380.conf配置</span></span><br><span class="line">port 6380</span><br><span class="line">daemonize yes</span><br><span class="line">logfile "6380.log"</span><br><span class="line">dbfilename "dump-6380.rdb"</span><br><span class="line">dir "/var/redis/data/"</span><br><span class="line">slaveof 127.0.0.1 6379</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-6381.conf配置</span></span><br><span class="line">port 6381</span><br><span class="line">daemonize yes</span><br><span class="line">logfile "6381.log"</span><br><span class="line">dbfilename "dump-6381.rdb"</span><br><span class="line">dir "/var/redis/data/"</span><br><span class="line">slaveof 127.0.0.1 6379</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. 准备好了三个数据库实例，启动三个数据库实例</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动前记得先去创建redis数据存放的文件夹</span></span><br><span class="line">mkdir -p /var/redis/data/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动实例</span></span><br><span class="line">redis-server  redis-6379.conf</span><br><span class="line">redis-server  redis-6380.conf</span><br><span class="line">redis-server  redis-6381.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看redis服务是否已经启动</span></span><br><span class="line">ps -ef | grep redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. 确定主从关系</span><br><span class="line">redis-cli  -p 6379 info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=336,lag=0</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=336,lag=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis-cli  -p 6380 info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br></pre></td></tr></table></figure>



<h4 id="7、Redis-Sentinel安装配置"><a href="#7、Redis-Sentinel安装配置" class="headerlink" title="7、Redis Sentinel安装配置"></a>7、Redis Sentinel安装配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">1. Sentinel配置解析</span><br><span class="line">port 26379  // Sentinel的端口</span><br><span class="line">dir /var/redis/data/  // Sentinel日志文件存放位置</span><br><span class="line">logfile "26379.log"  // Sentinel日志文件名字</span><br><span class="line"></span><br><span class="line">// 当前Sentinel节点监控 127.0.0.1:6379 这个主节点</span><br><span class="line">// 2代表判断主节点失败至少需要2个Sentinel节点节点同意</span><br><span class="line">// mymaster是主节点的别名</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"></span><br><span class="line">// 每个Sentinel节点都要定期PING命令来判断Redis数据节点和其余Sentinel节点是否可达</span><br><span class="line">// 如果超过30000毫秒30s且没有回复，则判定不可达</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line">// 当Sentinel节点集合对主节点故障判定达成一致时，Sentinel领导者节点会做故障转移操作，选出新的主节点，</span><br><span class="line">// 原来的从节点会向新的主节点发起复制操作，限制每次向新的主节点发起复制操作的从节点个数为1</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line">//故障转移超时时间为180000毫秒</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"></span><br><span class="line">// 后台执行</span><br><span class="line">daemonize yes </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. 准备三个哨兵，开始监控主从架构</span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵配置文件redis-26379.conf</span></span><br><span class="line">port 26379  </span><br><span class="line">dir /var/redis/data/</span><br><span class="line">logfile "26379.log"</span><br><span class="line">sentinel monitor zbjmaster  127.0.0.1 6379 2</span><br><span class="line">sentinel down-after-milliseconds zbjmaster 30000</span><br><span class="line">sentinel parallel-syncs zbjmaster 1</span><br><span class="line">sentinel failover-timeout zbjmaster 180000</span><br><span class="line">daemonize yes </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵配置文件redis-26380.conf</span></span><br><span class="line">port 26380  </span><br><span class="line">dir /var/redis/data/</span><br><span class="line">logfile "26380.log"</span><br><span class="line">sentinel monitor zbjmaster  127.0.0.1 6379 2</span><br><span class="line">sentinel down-after-milliseconds zbjmaster 30000</span><br><span class="line">sentinel parallel-syncs zbjmaster 1</span><br><span class="line">sentinel failover-timeout zbjmaster 180000</span><br><span class="line">daemonize yes </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵配置文件redis-26381.conf</span></span><br><span class="line">port 26381  </span><br><span class="line">dir /var/redis/data/</span><br><span class="line">logfile "26381.log"</span><br><span class="line">sentinel monitor zbjmaster  127.0.0.1 6379 2</span><br><span class="line">sentinel down-after-milliseconds zbjmaster 30000</span><br><span class="line">sentinel parallel-syncs zbjmaster 1</span><br><span class="line">sentinel failover-timeout zbjmaster 180000</span><br><span class="line">daemonize yes </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">3. 启动三个哨兵实例</span><br><span class="line">redis-sentinel redis-26379.conf</span><br><span class="line">redis-sentinel redis-26380.conf</span><br><span class="line">redis-sentinel redis-26381.conf</span><br><span class="line"></span><br><span class="line">注意！！如果发现实验不成功，需删掉所有的哨兵配置文件，从新来过</span><br><span class="line">注意！！如果发现实验不成功，需删掉所有的哨兵配置文件，从新来过</span><br><span class="line">注意！！如果发现实验不成功，需删掉所有的哨兵配置文件，从新来过</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查哨兵状态是否正常</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 只有发现如下信息，即为正常</span></span><br><span class="line">redis-cli -p 26379 info sentinel</span><br><span class="line"><span class="meta">#</span><span class="bash"> Sentinel</span></span><br><span class="line">sentinel_masters:1</span><br><span class="line">sentinel_tilt:0</span><br><span class="line">sentinel_running_scripts:0</span><br><span class="line">sentinel_scripts_queue_length:0</span><br><span class="line">sentinel_simulate_failure_flags:0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最重要的一句</span></span><br><span class="line">master0:name=zbjmaster,status=ok,address=127.0.0.1:6380,slaves=2,sentinels=3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. 测试哨兵的自动主从切换</span><br><span class="line">1,干掉6379的redis数据库</span><br><span class="line">    kill -9 6379的PID</span><br><span class="line"></span><br><span class="line">2,查看6380和6381的身份信息，是否自动的进行主从切换</span><br><span class="line">    我们设置的是30s后master没有响应，哨兵自动进行主从切换，因此30s后查看主从信息</span><br><span class="line">    redis-cli -p 6380 info replication</span><br><span class="line">    redis-cli -p 6381 info replication</span><br><span class="line">    </span><br><span class="line">3,手动启动6379挂掉的数据库，查看是否会被哨兵，添加进信息的主从集群</span><br><span class="line">    redis-server redis-6379.conf</span><br><span class="line">    redis-cli -p 6379 info replication</span><br></pre></td></tr></table></figure>



<h3 id="二、redis分区和集群"><a href="#二、redis分区和集群" class="headerlink" title="二、redis分区和集群"></a>二、redis分区和集群</h3><h4 id="1、什么是分区和集群"><a href="#1、什么是分区和集群" class="headerlink" title="1、什么是分区和集群"></a>1、什么是分区和集群</h4><ol>
<li><p>分区<br><strong>分区是分割数据到多个Redis实例的处理过程</strong>，因此每个实例只保存key的一个子集。<br>分区可以让Redis管理更大的内存，Redis将可以使用所有机器的内存。如果没有分区，你最多只能使用一台机器的内存。<br>分区使Redis的计算能力通过简单地增加计算机得到成倍提升,Redis的网络带宽也会随着计算机和网卡的增加而成倍增长。</p>
</li>
<li><p>集群<br><strong>redis集群就是分区的一种的实现</strong></p>
</li>
</ol>
<h4 id="2、为什么要用分区"><a href="#2、为什么要用分区" class="headerlink" title="2、为什么要用分区"></a>2、为什么要用分区</h4><ol>
<li>并发问题<br>官方声称 redis 每秒可以执行10万条命令<br>但是假如业务需要每秒100万的命令执行呢(例如新浪微博某某明星出轨、官宣之类的)</li>
</ol>
<ol start="2">
<li>数据量<br>当数据量太大的时候，一台服务器内存正常是16~256G，假如你的业务需要500G内存，怎么办？</li>
</ol>
<ol start="3">
<li>解决方案<ol>
<li>方案一：<br>配置一台超级牛逼的服务器，拥有超大内存和超强的cpu，<br>但是这么做的成本是非常高的，而且，万一这台机器宕掉了，那你的服务还不是全挂了。</li>
<li>方案二：<br>考虑分布式，加机器，把数据分到不同的位置，分摊集中式的压力，一堆机器做一件事。</li>
</ol>
</li>
</ol>
<h4 id="3、分区的数据分布理论"><a href="#3、分区的数据分布理论" class="headerlink" title="3、分区的数据分布理论"></a>3、分区的数据分布理论</h4><p>redis是一个非关系型数据库，它的存储是key-value形式的，<br>redis实例集群主要思想是将redis数据的key进行散列，通过hash函数特定的key会映射到指定的redis节点上</p>
<p>分布式数据库首要解决把整个数据集按照分区规则映射到多个节点的问题，即把数据集划分到多个节点上，每个节点负责整个数据的一个子集。</p>
<p><strong>常见的分区规则有哈希分区和顺序分区。</strong></p>
<h4 id="4、顺序分区"><a href="#4、顺序分区" class="headerlink" title="4、顺序分区"></a>4、顺序分区</h4><p>假设我有三个节点，100个redis的数据，按照平均值(几乎是平均的)，顺序分区的规则就是：<br>把1-33个数据 放在 node1<br>把34-66个数据 放在node2<br>把67-100个数据 放在node3</p>
<h4 id="5、哈希分区"><a href="#5、哈希分区" class="headerlink" title="5、哈希分区"></a>5、哈希分区</h4><ol>
<li>节点取余<br>例如按照节点取余的方式，分三个节点<br>1~100的数据对3取余，可以分为三类<br>余数为0<br>余数为1<br>余数为2<br>把余数为0的数据存到同一个节点<br>把余数为1的数据存到同一个节点<br>把余数为2的数据存到同一个节点</li>
</ol>
<p>那么同样的分4个节点就是hash(key)%4，余数相同的存到同一个节点<br>节点取余的优点是简单，客户端分片直接是哈希+取余</p>
<ol start="2">
<li>一致性哈希<br>客户端进行分片，哈希+顺时针取余</li>
<li>虚拟槽分区<br>本文研究哈希分区之虚拟槽分区，因此下面单独来聊一聊</li>
</ol>
<h3 id="三、哈希分区之虚拟槽分区"><a href="#三、哈希分区之虚拟槽分区" class="headerlink" title="三、哈希分区之虚拟槽分区"></a>三、哈希分区之虚拟槽分区</h3><h4 id="1、介绍-1"><a href="#1、介绍-1" class="headerlink" title="1、介绍"></a>1、介绍</h4><p>Redis Cluster采用的就是虚拟槽分区</p>
<p>虚拟槽分区巧妙地使用了哈希空间，使用分散度良好的哈希函数把所有的数据映射到一个固定范围内的整数集合，<br>这些整数就定义为槽（slot）。</p>
<p><strong>Redis Cluster槽的范围是0 ～ 16383，即一共16384个槽</strong>。</p>
<p>槽是集群内数据管理和迁移的基本单位。采用大范围的槽的主要目的是为了方便数据的拆分和集群的扩展，</p>
<p>每个节点(redis实例)负责一定数量的槽。</p>
<h4 id="2、虚拟槽图解"><a href="#2、虚拟槽图解" class="headerlink" title="2、虚拟槽图解"></a>2、虚拟槽图解</h4><p><img src="https://img2018.cnblogs.com/blog/1449477/201901/1449477-20190117082348428-1446271590.png" alt="img"></p>
<h4 id="3、搭建redis-cluster"><a href="#3、搭建redis-cluster" class="headerlink" title="3、搭建redis cluster"></a>3、搭建redis cluster</h4><p>redis支持多实例的功能，我们在单机演示集群搭建，需要6个实例，三个是主节点，三个是从节点，数量为6个节点才能保证高可用的集群。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">1.准备6个节点，用于存储数据，分配槽位，每个节点的配置，如下，仅仅是端口的区别</span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-7000.conf配置</span></span><br><span class="line">port 7000</span><br><span class="line">daemonize yes</span><br><span class="line">dir "/opt/redis/data"</span><br><span class="line">logfile "7000.log"</span><br><span class="line">dbfilename "dump-7000.rdb"</span><br><span class="line">cluster-enabled yes  </span><br><span class="line">cluster-config-file nodes-7000.conf　</span><br><span class="line"></span><br><span class="line">其余5个配置跟上面一模一样，仅仅是端口的区别</span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-7001.conf配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-7002.conf配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-7003.conf配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-7004.conf配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-7005.conf配置</span></span><br><span class="line"></span><br><span class="line">注意：要创建存放日志的文件夹  mkdir -p /opt/redis/data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.启动6个数据库实例</span><br><span class="line">redis-server redis-7000.conf</span><br><span class="line">redis-server redis-7001.conf</span><br><span class="line">redis-server redis-7002.conf</span><br><span class="line">redis-server redis-7003.conf</span><br><span class="line">redis-server redis-7004.conf</span><br><span class="line">redis-server redis-7005.conf</span><br><span class="line"></span><br><span class="line">3.开始分配redis集群状态，以及槽位分配</span><br><span class="line">Redis Cluster本身提供了自动将数据分散到Redis Cluster不同节点的能力，</span><br><span class="line">但是槽位的分配就比较麻烦了，当然了，如果你是大神，你完全可以自定义槽位的分配，</span><br><span class="line">一些大神已经写好了槽位分配的工具或脚本了，例如豆瓣公司开源的codis工具，还有ruby语言的作者，写的redsi.rb，</span><br><span class="line">因此我们可以使用一些工具帮我们进行redis cluster的搭建</span><br><span class="line"></span><br><span class="line">4.通过ruby脚本，一键创建redis-cluster,进行槽位分配</span><br><span class="line"></span><br><span class="line">5.准备ruby的编程环境</span><br><span class="line">1,下载ruby的源码包</span><br><span class="line">wget https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.3.1.tar.gz</span><br><span class="line"></span><br><span class="line">2,解压缩ruby远吗</span><br><span class="line">tar -zxvf ruby-2.3.1.tar.gz</span><br><span class="line"></span><br><span class="line">3,开始编译安装ruby</span><br><span class="line">进入ruby源码包</span><br><span class="line">./configure --prefix=/opt/ruby/</span><br><span class="line"></span><br><span class="line">4,开始编译且编译安装</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">5,配置ruby的环境变量</span><br><span class="line">vim /etc/profile </span><br><span class="line">写入如下配置</span><br><span class="line">PATH=你原本的PATH:/opt/ruby/bin</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">6.安装ruby操作redis的模块</span><br><span class="line">1,下载ruby操作redis的模块</span><br><span class="line">wget http://rubygems.org/downloads/redis-3.3.0.gem</span><br><span class="line"></span><br><span class="line">2,安装</span><br><span class="line">gem install -l redis-3.3.0.gem</span><br><span class="line"></span><br><span class="line">3,搜索创建redis集群的命令</span><br><span class="line">find /opt  -name  redis-trib.rb</span><br><span class="line">/opt/redis-4.0.10/src/redis-trib.rb</span><br><span class="line"></span><br><span class="line">7.一键创建redis集群</span><br><span class="line">/opt/redis-4.0.10/src/redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005</span><br><span class="line">--replicas  进行身份授权 </span><br><span class="line">后面的1  代表，每个主节点，只有一个从节点</span><br><span class="line">默认将 7000  7001  70002  设置为主库</span><br><span class="line">将7003  7004  7005  设置为从库</span><br><span class="line"></span><br><span class="line">8.检查集群状态</span><br><span class="line">redis-cli -p 7000 cluster info</span><br><span class="line"></span><br><span class="line">9.测试集群节点，看是否能正常写入数据</span><br><span class="line">redis-cli -c -p 7000</span><br><span class="line">    -p  指定数据库端口</span><br><span class="line">    -c  指定开启集群模式</span><br><span class="line"></span><br><span class="line">set age 18  # 设置一个key会自动分配槽位，重定向到槽位所在的节点即代表成功</span><br><span class="line"></span><br><span class="line">在任意一个节点都可以get age，会自动重定向到 age 所在的节点。</span><br><span class="line"></span><br><span class="line">10.redis-cluster 会默认将不同的key，进行CRC16算法，进行分配到不同槽位</span><br><span class="line"></span><br><span class="line">11.数据正常重定向，即redis集群ok</span><br></pre></td></tr></table></figure>

<h3 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h3><ul>
<li><a href="https://www.cnblogs.com/Zzbj/p/10280363.html" target="_blank" rel="noopener">https://www.cnblogs.com/Zzbj/p/10280363.html</a></li>
<li><a href="https://www.cnblogs.com/rjzheng/p/10360619.html" target="_blank" rel="noopener">https://www.cnblogs.com/rjzheng/p/10360619.html</a></li>
</ul>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Redis/" rel="tag"># Redis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/19/2020/03/Reactor%E6%A8%A1%E5%9E%8B%E7%9A%84Java%20NIO%E5%AE%9E%E7%8E%B0/" rel="next" title="Reactor模型的Java NIO实现">
                <i class="fa fa-chevron-left"></i> Reactor模型的Java NIO实现
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/03/21/2020/03/Redis%E4%BA%8B%E5%8A%A1%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" rel="prev" title="Redis事务的设计与实现">
                Redis事务的设计与实现 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/%E4%B8%AA%E4%BA%BA%E5%A4%B4%E5%83%8F.jpg"
                alt="Vernon" />
            
              <p class="site-author-name" itemprop="name">Vernon</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%7C%7C%20archive">
                
                    <span class="site-state-item-count">149</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">66</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">87</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/chengcheng222e" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:chengcheng222e@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、Redis-Sentinel-哨兵"><span class="nav-number">1.</span> <span class="nav-text">一、Redis-Sentinel(哨兵)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、介绍"><span class="nav-number">1.1.</span> <span class="nav-text">1、介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、工作原理"><span class="nav-number">1.2.</span> <span class="nav-text">2、工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、master宕机处理"><span class="nav-number">1.3.</span> <span class="nav-text">3、master宕机处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、Sentinel功能实现图"><span class="nav-number">1.4.</span> <span class="nav-text">4、Sentinel功能实现图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、redis一些查看命令"><span class="nav-number">1.5.</span> <span class="nav-text">5、redis一些查看命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6、Redis主从配置"><span class="nav-number">1.6.</span> <span class="nav-text">6、Redis主从配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7、Redis-Sentinel安装配置"><span class="nav-number">1.7.</span> <span class="nav-text">7、Redis Sentinel安装配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、redis分区和集群"><span class="nav-number">2.</span> <span class="nav-text">二、redis分区和集群</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、什么是分区和集群"><span class="nav-number">2.1.</span> <span class="nav-text">1、什么是分区和集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、为什么要用分区"><span class="nav-number">2.2.</span> <span class="nav-text">2、为什么要用分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、分区的数据分布理论"><span class="nav-number">2.3.</span> <span class="nav-text">3、分区的数据分布理论</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4、顺序分区"><span class="nav-number">2.4.</span> <span class="nav-text">4、顺序分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5、哈希分区"><span class="nav-number">2.5.</span> <span class="nav-text">5、哈希分区</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、哈希分区之虚拟槽分区"><span class="nav-number">3.</span> <span class="nav-text">三、哈希分区之虚拟槽分区</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、介绍-1"><span class="nav-number">3.1.</span> <span class="nav-text">1、介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、虚拟槽图解"><span class="nav-number">3.2.</span> <span class="nav-text">2、虚拟槽图解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3、搭建redis-cluster"><span class="nav-number">3.3.</span> <span class="nav-text">3、搭建redis cluster</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考地址"><span class="nav-number">4.</span> <span class="nav-text">参考地址</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vernon</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.4</div>



  <div class="footer-custom"><a target="_blank" href="https://beian.miit.gov.cn">粤ICP备2025433887号</a></div>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
